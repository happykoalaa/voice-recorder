<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì½”ì•Œë¼ - ë‹¤ë¬¸í™” í•™ìƒ ìƒë‹´ í”„ë¡œê·¸ë¨</title>
    <link href="https://fonts.googleapis.com/css2?family=Gaegu:wght@300;400;700&family=Gamja+Flower&family=Poor+Story&family=Cute+Font&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Gamja Flower', 'Cute Font', cursive;
            background: linear-gradient(135deg, #a8e6cf 0%, #dcedc1 50%, #ffd3a5 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            text-align: center;
            max-width: 700px;
            width: 100%;
            min-height: 600px;
            border: 5px solid #ffb3ba;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        /* ì½”ì•Œë¼ ìºë¦­í„° */
        .koala-character {
            font-size: 8em;
            margin: 20px 0;
            display: inline-block;
            animation: koalaBounce 2s ease-in-out infinite;
        }

        @keyframes koalaBounce {
            0%, 100% { transform: translateY(0px) rotate(-2deg); }
            50% { transform: translateY(-15px) rotate(2deg); }
        }

        .koala-talking {
            animation: koalaTalk 1.5s ease-in-out infinite;
        }

        @keyframes koalaTalk {
            0%, 100% { transform: scale(1) rotate(-1deg); }
            50% { transform: scale(1.1) rotate(1deg); }
        }

        .koala-happy {
            animation: koalaHappy 1s ease-in-out infinite;
        }

        @keyframes koalaHappy {
            0%, 100% { transform: scale(1); }
            25% { transform: scale(1.1) rotate(-5deg); }
            75% { transform: scale(1.1) rotate(5deg); }
        }

        .koala-listening {
            animation: koalaListen 2s ease-in-out infinite;
        }

        @keyframes koalaListen {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.05) rotate(-3deg); }
            75% { transform: scale(1.05) rotate(3deg); }
        }

        .title {
            color: #2d5016;
            font-size: 3em;
            margin-bottom: 10px;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            font-family: 'Poor Story', cursive;
        }

        .program-title {
            color: #2d5016;
            font-size: 4.5em;
            margin-bottom: 20px;
            font-weight: 700;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.1);
            background: linear-gradient(45deg, #a8e6cf, #2d5016);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-family: 'Cute Font', cursive;
        }

        .subtitle {
            color: #5d4e75;
            font-size: 1.6em;
            margin-bottom: 30px;
            line-height: 1.6;
            font-weight: 400;
            font-family: 'Gamja Flower', cursive;
        }

        .koala-speech {
            background: #fff3cd;
            border: 3px solid #ffeaa7;
            border-radius: 20px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
            font-size: 1.5em;
            color: #2d5016;
            font-weight: 400;
            font-family: 'Poor Story', cursive;
            line-height: 1.5;
        }

        .koala-speech::before {
            content: '';
            position: absolute;
            bottom: -15px;
            left: 50%;
            transform: translateX(-50%);
            border: 15px solid transparent;
            border-top-color: #ffeaa7;
        }

        /* ì–¸ì–´ ì„ íƒ í™”ë©´ */
        .language-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        .language-card {
            background: linear-gradient(135deg, #ffb3ba, #ffdfba);
            border-radius: 25px;
            padding: 30px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 4px solid transparent;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .language-card:hover {
            transform: translateY(-10px) scale(1.05);
            border-color: #a8e6cf;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .flag {
            font-size: 4em;
            margin-bottom: 15px;
        }

        .language-name {
            font-size: 1.6em;
            font-weight: 700;
            color: #2d5016;
            font-family: 'Poor Story', cursive;
        }

        /* ì´ë¦„ ì„ íƒ í™”ë©´ */
        .name-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 30px 0;
        }

        .name-card {
            background: linear-gradient(135deg, #bae1ff, #baffc9);
            color: #2d5016;
            border-radius: 25px;
            padding: 30px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 4px solid transparent;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .name-card:hover {
            transform: scale(1.1) rotate(2deg);
            border-color: #ffb3ba;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .name-card .avatar {
            font-size: 4em;
            margin-bottom: 15px;
        }

        .name-card .name {
            font-size: 1.6em;
            font-weight: 700;
            font-family: 'Cute Font', cursive;
        }

        /* ê¸°ë¶„ ì„ íƒ í™”ë©´ */
        .mood-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 30px 0;
        }

        .mood-card {
            background: linear-gradient(135deg, #ffffba, #ffdfba);
            border-radius: 25px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 4px solid transparent;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .mood-card:hover {
            transform: scale(1.15) rotate(-3deg);
            border-color: #bae1ff;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .mood-emoji {
            font-size: 3.5em;
            margin-bottom: 10px;
        }

        .mood-text {
            font-size: 1.4em;
            font-weight: 700;
            color: #2d5016;
            font-family: 'Gamja Flower', cursive;
        }

        /* ë…¹ìŒ í™”ë©´ */
        .record-section {
            margin: 30px 0;
        }

        .record-button {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            border: 6px solid #a8e6cf;
            background: linear-gradient(45deg, #ffb3ba, #ff9ff3);
            color: white;
            font-size: 4em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 auto 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 20px 40px rgba(255, 179, 186, 0.4);
        }

        .record-button:hover {
            transform: scale(1.1);
        }

        .record-button.recording {
            background: linear-gradient(45deg, #ff6b6b, #ff8787);
            animation: recordPulse 1.5s infinite;
            border-color: #ff6b6b;
        }

        @keyframes recordPulse {
            0% { transform: scale(1); box-shadow: 0 20px 40px rgba(255, 107, 107, 0.4); }
            50% { transform: scale(1.2); box-shadow: 0 25px 50px rgba(255, 107, 107, 0.6); }
            100% { transform: scale(1); box-shadow: 0 20px 40px rgba(255, 107, 107, 0.4); }
        }

        .timer {
            font-size: 3em;
            font-weight: 700;
            color: #2d5016;
            margin: 20px 0;
            font-family: 'Cute Font', cursive;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .status {
            font-size: 1.7em;
            margin: 20px 0;
            color: #2d5016;
            font-weight: 500;
            font-family: 'Poor Story', cursive;
        }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn {
            padding: 15px 35px;
            border: none;
            border-radius: 30px;
            font-size: 1.5em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 700;
            margin: 15px;
            font-family: 'Gamja Flower', cursive;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .btn-primary {
            background: linear-gradient(45deg, #a8e6cf, #7fcdcd);
            color: #2d5016;
        }

        .btn-success {
            background: linear-gradient(45deg, #baffc9, #a8e6cf);
            color: #2d5016;
        }

        .btn-secondary {
            background: linear-gradient(45deg, #ffdfba, #ffeaa7);
            color: #2d5016;
        }

        .btn-teacher {
            background: linear-gradient(45deg, #d1a3ff, #bae1ff);
            color: #2d5016;
        }

        .btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
        }

        .btn:disabled {
            background: #ddd;
            cursor: not-allowed;
            transform: none;
        }

        /* êµì‚¬ í™”ë©´ */
        .teacher-screen {
            background: linear-gradient(135deg, #e8f4fd 0%, #d6eef0 100%);
            border: 5px solid #7fcdcd;
        }

        .teacher-header {
            background: linear-gradient(45deg, #7fcdcd, #a8e6cf);
            color: #2d5016;
            padding: 20px;
            border-radius: 20px;
            margin-bottom: 30px;
            font-size: 1.8em;
            font-weight: 700;
            font-family: 'Poor Story', cursive;
        }

        .session-list {
            display: grid;
            gap: 20px;
            margin: 30px 0;
            max-height: 500px;
            overflow-y: auto;
        }

        .session-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border-left: 6px solid #a8e6cf;
            text-align: left;
        }

        .session-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .student-info {
            font-size: 1.4em;
            font-weight: 700;
            color: #2d5016;
        }

        .session-time {
            font-size: 1.1em;
            color: #5d4e75;
        }

        .mood-display {
            font-size: 1.3em;
            margin: 10px 0;
            color: #2d5016;
        }

        .audio-section {
            margin: 15px 0;
        }

        .text-content {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            font-size: 1.2em;
            line-height: 1.6;
            color: #333;
        }

        /* êµì‚¬ ë²„íŠ¼ (ìš°ìƒë‹¨) */
        .teacher-access {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .teacher-btn {
            background: linear-gradient(45deg, #d1a3ff, #bae1ff);
            color: #2d5016;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            font-family: 'Gamja Flower', cursive;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            font-size: 1.1em;
        }

        .teacher-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        /* í•˜ë‹¨ ì½”ì•Œë¼ ì¥ì‹ */
        .bottom-koalas {
            position: fixed;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2em;
            opacity: 0.3;
        }

        .floating-koala {
            display: inline-block;
            margin: 0 10px;
            animation: floatKoala 3s ease-in-out infinite;
        }

        .floating-koala:nth-child(2) {
            animation-delay: 1s;
        }

        .floating-koala:nth-child(3) {
            animation-delay: 2s;
        }

        @keyframes floatKoala {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        /* ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #a8e6cf;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            .koala-character {
                font-size: 5em;
            }
            
            .title {
                font-size: 2em;
            }
            
            .program-title {
                font-size: 2.5em;
            }
        }
    </style>
</head>
<body>
    <!-- êµì‚¬ ì ‘ê·¼ ë²„íŠ¼ -->
    <div class="teacher-access">
        <button class="teacher-btn" onclick="toggleTeacherView()">
            ğŸ‘©â€ğŸ« êµì‚¬ í™”ë©´
        </button>
    </div>

    <div class="container" id="studentContainer">
        <!-- 1. ì–¸ì–´ ì„ íƒ í™”ë©´ -->
        <div class="screen active" id="languageScreen">
            <h1 class="program-title">ğŸ¨ ì½”ì•Œë¼</h1>
            <div class="koala-character">ğŸ¨</div>
            <div class="koala-speech">ì•ˆë…•! ë‚˜ëŠ” ì½”ì•Œë¼ì•¼! ì–´ë–¤ ì–¸ì–´ë¡œ ì´ì•¼ê¸°í• ê¹Œ?<br>
            Hello! I'm Koala! Which language?<br>
            ĞŸÑ€Ğ¸Ğ²ĞµÑ‚! Ğ¯ ĞšĞ¾Ğ°Ğ»Ğ°! ĞĞ° ĞºĞ°ĞºĞ¾Ğ¼ ÑĞ·Ñ‹ĞºĞµ?<br>
            Xin chÃ o! TÃ´i lÃ  Koala! NgÃ´n ngá»¯ nÃ o?</div>
            <div class="language-grid">
                <div class="language-card" onclick="selectLanguage('ko')">
                    <div class="flag">ğŸ‡°ğŸ‡·</div>
                    <div class="language-name">í•œêµ­ì–´</div>
                </div>
                <div class="language-card" onclick="selectLanguage('ru')">
                    <div class="flag">ğŸ‡·ğŸ‡º</div>
                    <div class="language-name">Ğ ÑƒÑÑĞºĞ¸Ğ¹</div>
                </div>
                <div class="language-card" onclick="selectLanguage('vi')">
                    <div class="flag">ğŸ‡»ğŸ‡³</div>
                    <div class="language-name">Tiáº¿ng Viá»‡t</div>
                </div>
            </div>
        </div>

        <!-- 2. ì´ë¦„ ì„ íƒ í™”ë©´ -->
        <div class="screen" id="nameScreen">
            <h1 class="title">ğŸ¨ ì½”ì•Œë¼ì™€ ì¹œêµ¬í•˜ê¸°</h1>
            <div class="koala-character koala-happy">ğŸ¨</div>
            <div class="koala-speech" id="nameKoalaSpeech">ë„ˆëŠ” ëˆ„êµ¬ë‹ˆ? ì´ë¦„ì„ ê³¨ë¼ì¤˜!</div>
            <div class="name-grid">
                <div class="name-card" onclick="selectName('ë¦¬ë§ˆí¬')">
                    <div class="avatar">ğŸ‘¦</div>
                    <div class="name">ë¦¬ë§ˆí¬</div>
                </div>
                <div class="name-card" onclick="selectName('ëˆ„ì—”í‹°ì„±ìš°')">
                    <div class="avatar">ğŸ‘¨</div>
                    <div class="name">ëˆ„ì—”í‹°ì„±ìš°</div>
                </div>
                <div class="name-card" onclick="selectName('ì •ì‹œìœ¨')">
                    <div class="avatar">ğŸ§’</div>
                    <div class="name">ì •ì‹œìœ¨</div>
                </div>
                <div class="name-card" onclick="selectName('ì¡°ìš©ì›')">
                    <div class="avatar">ğŸ‘¶</div>
                    <div class="name">ì¡°ìš©ì›</div>
                </div>
            </div>
        </div>

        <!-- 3. ê¸°ë¶„ ì„ íƒ í™”ë©´ -->
        <div class="screen" id="moodScreen">
            <h1 class="title">ğŸ¨ ì˜¤ëŠ˜ ê¸°ë¶„ì´ ì–´ë•Œ?</h1>
            <div class="koala-character koala-talking">ğŸ¨</div>
            <div class="koala-speech" id="moodKoalaSpeech">ì˜¤ëŠ˜ ê¸°ë¶„ì´ ì–´ë–¤ì§€ ì½”ì•Œë¼ì—ê²Œ ì•Œë ¤ì¤˜!</div>
            <div class="mood-grid">
                <div class="mood-card" onclick="selectMood('ë§¤ìš° ì¢‹ìŒ', 'ğŸ˜„')">
                    <div class="mood-emoji">ğŸ˜„</div>
                    <div class="mood-text">ë§¤ìš° ì¢‹ìŒ</div>
                </div>
                <div class="mood-card" onclick="selectMood('ì¢‹ìŒ', 'ğŸ˜Š')">
                    <div class="mood-emoji">ğŸ˜Š</div>
                    <div class="mood-text">ì¢‹ìŒ</div>
                </div>
                <div class="mood-card" onclick="selectMood('ë³´í†µ', 'ğŸ˜')">
                    <div class="mood-emoji">ğŸ˜</div>
                    <div class="mood-text">ë³´í†µ</div>
                </div>
                <div class="mood-card" onclick="selectMood('ìŠ¬í””', 'ğŸ˜¢')">
                    <div class="mood-emoji">ğŸ˜¢</div>
                    <div class="mood-text">ìŠ¬í””</div>
                </div>
                <div class="mood-card" onclick="selectMood('í™”ë‚¨', 'ğŸ˜ ')">
                    <div class="mood-emoji">ğŸ˜ </div>
                    <div class="mood-text">í™”ë‚¨</div>
                </div>
                <div class="mood-card" onclick="selectMood('í”¼ê³¤í•¨', 'ğŸ˜´')">
                    <div class="mood-emoji">ğŸ˜´</div>
                    <div class="mood-text">í”¼ê³¤í•¨</div>
                </div>
            </div>
        </div>

        <!-- 4. ë…¹ìŒ í™”ë©´ -->
        <div class="screen" id="recordScreen">
            <h1 class="title">ğŸ¨ ì½”ì•Œë¼ì—ê²Œ ì´ì•¼ê¸°í•´ì¤˜</h1>
            <div class="koala-character koala-listening">ğŸ¨</div>
            <div class="koala-speech" id="recordKoalaSpeech">ì½”ì•Œë¼ê°€ ê·€ ê¸°ìš¸ì—¬ ë“£ê³  ìˆì–´! ë§ˆì´í¬ë¥¼ ëˆŒëŸ¬ì„œ ì´ì•¼ê¸°í•´ì¤˜!</div>
            
            <div class="record-section">
                <div class="status" id="recordStatus">ë§ˆì´í¬ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”</div>
                <div class="timer" id="recordTimer">00:00</div>
                <button class="record-button" id="recordButton">
                    ğŸ¤
                </button>
                <div>
                    <button class="btn btn-success" id="finishButton" onclick="finishRecording()" disabled>
                        âœ… ì´ì•¼ê¸° ëë‚´ê¸°
                    </button>
                </div>
            </div>
        </div>

        <!-- 5. ì™„ë£Œ í™”ë©´ -->
        <div class="screen" id="completeScreen">
            <h1 class="title">ğŸ¨ ê³ ë§ˆì›Œ!</h1>
            <div class="koala-character koala-happy">ğŸ¨</div>
            <div class="koala-speech">ì†Œì¤‘í•œ ì´ì•¼ê¸°ë¥¼ ë“¤ë ¤ì¤˜ì„œ ê³ ë§ˆì›Œ! ì½”ì•Œë¼ê°€ ì„ ìƒë‹˜ê»˜ ì˜ ì „ë‹¬í• ê²Œ!</div>
            <div>
                <button class="btn btn-primary" onclick="startNew()">ğŸ”„ ë‹¤ì‹œ ì´ì•¼ê¸°í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <!-- êµì‚¬ í™”ë©´ -->
    <div class="container teacher-screen" id="teacherContainer" style="display: none;">
        <div class="teacher-header">
            <div>ğŸ‘©â€ğŸ« êµì‚¬ ìƒë‹´ ê´€ë¦¬ ì‹œìŠ¤í…œ</div>
            <div style="font-size: 0.8em; margin-top: 10px;">ì´ ìƒë‹´ ì„¸ì…˜: <span id="totalSessions">0</span>ê°œ</div>
        </div>
        
        <div>
            <button class="btn btn-secondary" onclick="toggleTeacherView()">ğŸ”™ í•™ìƒ í™”ë©´ìœ¼ë¡œ</button>
            <button class="btn btn-primary" onclick="downloadAllReports()">ğŸ“Š ì „ì²´ ë³´ê³ ì„œ ë‹¤ìš´ë¡œë“œ</button>
            <button class="btn btn-teacher" onclick="clearAllSessions()">ğŸ—‘ï¸ ë°ì´í„° ì´ˆê¸°í™”</button>
        </div>

        <div class="session-list" id="sessionList">
            <div style="text-align: center; color: #666; font-size: 1.3em; margin: 50px 0;">
                ì•„ì§ ìƒë‹´ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.
            </div>
        </div>
    </div>

    <!-- í•˜ë‹¨ ì¥ì‹ ì½”ì•Œë¼ë“¤ -->
    <div class="bottom-koalas">
        <span class="floating-koala">ğŸ¨</span>
        <span class="floating-koala">ğŸ¨</span>
        <span class="floating-koala">ğŸ¨</span>
    </div>

    <script>
        class KoalaProgram {
            constructor() {
                this.currentScreen = 'languageScreen';
                this.sessionData = {
                    language: '',
                    name: '',
                    mood: '',
                    moodEmoji: '',
                    timestamp: '',
                    audioBlob: null,
                    transcription: '',
                    translation: ''
                };
                
                this.mediaRecorder = null;
                this.audioChunks = [];
                this.isRecording = false;
                this.recordingTime = 0;
                this.timerInterval = null;
                this.allSessions = JSON.parse(localStorage.getItem('koalaSessions') || '[]');
                this.isTeacherView = false;
                
                this.initializeElements();
                this.updateKoalaSpeech();
            }

            initializeElements() {
                this.recordButton = document.getElementById('recordButton');
                this.finishButton = document.getElementById('finishButton');
                this.recordStatus = document.getElementById('recordStatus');
                this.recordTimer = document.getElementById('recordTimer');
                
                this.recordButton.addEventListener('click', () => this.toggleRecording());
            }

            updateKoalaSpeech() {
                const speeches = {
                    'ko': {
                        name: 'ë„ˆëŠ” ëˆ„êµ¬ë‹ˆ? ì´ë¦„ì„ ê³¨ë¼ì¤˜!',
                        mood: 'ì˜¤ëŠ˜ ê¸°ë¶„ì´ ì–´ë–¤ì§€ ì½”ì•Œë¼ì—ê²Œ ì•Œë ¤ì¤˜!',
                        record: 'ì½”ì•Œë¼ê°€ ê·€ ê¸°ìš¸ì—¬ ë“£ê³  ìˆì–´! ë§ˆì´í¬ë¥¼ ëˆŒëŸ¬ì„œ ì´ì•¼ê¸°í•´ì¤˜!'
                    },
                    'ru': {
                        name: 'ĞšÑ‚Ğ¾ Ñ‚Ñ‹? Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸ ÑĞ²Ğ¾Ğµ Ğ¸Ğ¼Ñ!',
                        mood: 'Ğ Ğ°ÑÑĞºĞ°Ğ¶Ğ¸ ĞºĞ¾Ğ°Ğ»Ğµ, ĞºĞ°Ğº Ñ‚Ğ²Ğ¾Ğ¸ Ğ´ĞµĞ»Ğ° ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ!',
                        record: 'ĞšĞ¾Ğ°Ğ»Ğ° Ğ²Ğ½Ğ¸Ğ¼Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ ÑĞ»ÑƒÑˆĞ°ĞµÑ‚! ĞĞ°Ğ¶Ğ¼Ğ¸ Ğ½Ğ° Ğ¼Ğ¸ĞºÑ€Ğ¾Ñ„Ğ¾Ğ½ Ğ¸ Ñ€Ğ°ÑÑĞºĞ°Ğ¶Ğ¸!'
                    },
                    'vi': {
                        name: 'Báº¡n lÃ  ai? HÃ£y chá»n tÃªn cá»§a báº¡n!',
                        mood: 'HÃ£y cho koala biáº¿t hÃ´m nay báº¡n cáº£m tháº¥y tháº¿ nÃ o!',
                        record: 'Koala Ä‘ang láº¯ng nghe chÄƒm chÃº! Nháº¥n micro vÃ  ká»ƒ cho koala nghe nhÃ©!'
                    }
                };

                const lang = this.sessionData.language || 'ko';
                const speech = speeches[lang];
                
                if (document.getElementById('nameKoalaSpeech')) {
                    document.getElementById('nameKoalaSpeech').textContent = speech.name;
                }
                if (document.getElementById('moodKoalaSpeech')) {
                    document.getElementById('moodKoalaSpeech').textContent = speech.mood;
                }
                if (document.getElementById('recordKoalaSpeech')) {
                    document.getElementById('recordKoalaSpeech').textContent = speech.record;
                }
            }

            showScreen(screenId) {
                document.querySelectorAll('.screen').forEach(screen => {
                    screen.classList.remove('active');
                });
                document.getElementById(screenId).classList.add('active');
                this.currentScreen = screenId;
            }

            async toggleRecording() {
                if (!this.isRecording) {
                    await this.startRecording();
                } else {
                    this.stopRecording();
                }
            }

            async startRecording() {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    
                    this.mediaRecorder = new MediaRecorder(stream);
                    this.audioChunks = [];
                    
                    this.mediaRecorder.ondataavailable = (event) => {
                        this.audioChunks.push(event.data);
                    };
                    
                    this.mediaRecorder.onstop = () => {
                        const audioBlob = new Blob(this.audioChunks, { type: 'audio/wav' });
                        this.sessionData.audioBlob = audioBlob;
                        this.finishButton.disabled = false;
                        stream.getTracks().forEach(track => track.stop());
                    };
                    
                    this.mediaRecorder.start();
                    this.isRecording = true;
                    this.recordingTime = 0;
                    
                    this.updateRecordingUI();
                }
            }

            startTimer() {
                this.timerInterval = setInterval(() => {
                    this.recordingTime++;
                    this.recordTimer.textContent = this.formatTime(this.recordingTime);
                }, 1000);
            }

            stopTimer() {
                if (this.timerInterval) {
                    clearInterval(this.timerInterval);
                    this.timerInterval = null;
                }
            }

            formatTime(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
            }

            updateRecordingUI() {
                if (this.isRecording) {
                    this.recordButton.classList.add('recording');
                    this.recordButton.textContent = 'â¹ï¸';
                    this.recordStatus.textContent = 'ë…¹ìŒ ì¤‘... ë‹¤ì‹œ í´ë¦­í•˜ë©´ ì¤‘ì§€ë©ë‹ˆë‹¤';
                } else {
                    this.recordButton.classList.remove('recording');
                    this.recordButton.textContent = 'ğŸ¤';
                    this.recordStatus.textContent = this.sessionData.audioBlob ? 
                        'ë…¹ìŒ ì™„ë£Œ! ì´ì•¼ê¸° ëë‚´ê¸° ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”' : 'ë§ˆì´í¬ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”';
                }
            }

            async processSession() {
                this.sessionData.timestamp = new Date().toLocaleString('ko-KR');
                
                // ìŒì„± ì¸ì‹ ë° ë²ˆì—­ ì‹œë®¬ë ˆì´ì…˜
                await this.simulateTranscription();
                
                // ì„¸ì…˜ ë°ì´í„° ì €ì¥
                const sessionRecord = {
                    id: Date.now(),
                    ...this.sessionData,
                    audioUrl: this.sessionData.audioBlob ? URL.createObjectURL(this.sessionData.audioBlob) : null
                };
                
                this.allSessions.push(sessionRecord);
                localStorage.setItem('koalaSessions', JSON.stringify(this.allSessions));
                
                this.showScreen('completeScreen');
            }

            async simulateTranscription() {
                // ì‹¤ì œë¡œëŠ” Web Speech API ë˜ëŠ” ì™¸ë¶€ ìŒì„±ì¸ì‹ ì„œë¹„ìŠ¤ ì‚¬ìš©
                const sampleTexts = {
                    'ko': 'ì˜¤ëŠ˜ í•™êµì—ì„œ ì¹œêµ¬ë“¤ê³¼ ì¬ë¯¸ìˆê²Œ ë†€ì•˜ì–´ìš”. í•˜ì§€ë§Œ ìˆ˜í•™ ì‹œê°„ì´ ì¡°ê¸ˆ ì–´ë ¤ì› ì–´ìš”.',
                    'ru': 'Ğ¡ĞµĞ³Ğ¾Ğ´Ğ½Ñ Ğ² ÑˆĞºĞ¾Ğ»Ğµ Ğ±Ñ‹Ğ»Ğ¾ Ğ²ĞµÑĞµĞ»Ğ¾ Ğ¸Ğ³Ñ€Ğ°Ñ‚ÑŒ Ñ Ğ´Ñ€ÑƒĞ·ÑŒÑĞ¼Ğ¸. ĞĞ¾ ÑƒÑ€Ğ¾Ğº Ğ¼Ğ°Ñ‚ĞµĞ¼Ğ°Ñ‚Ğ¸ĞºĞ¸ Ğ±Ñ‹Ğ» Ğ½ĞµĞ¼Ğ½Ğ¾Ğ³Ğ¾ Ñ‚Ñ€ÑƒĞ´Ğ½Ñ‹Ğ¼.',
                    'vi': 'HÃ´m nay á»Ÿ trÆ°á»ng chÆ¡i vá»›i báº¡n bÃ¨ ráº¥t vui. NhÆ°ng tiáº¿t toÃ¡n hÆ¡i khÃ³.'
                };
                
                this.sessionData.transcription = sampleTexts[this.sessionData.language] || sampleTexts['ko'];
                
                if (this.sessionData.language !== 'ko') {
                    this.sessionData.translation = 'ì˜¤ëŠ˜ í•™êµì—ì„œ ì¹œêµ¬ë“¤ê³¼ ì¬ë¯¸ìˆê²Œ ë†€ì•˜ì–´ìš”. í•˜ì§€ë§Œ ìˆ˜í•™ ì‹œê°„ì´ ì¡°ê¸ˆ ì–´ë ¤ì› ì–´ìš”.';
                }
            }

            getLanguageName(code) {
                const languages = {
                    'ko': 'í•œêµ­ì–´',
                    'ru': 'ëŸ¬ì‹œì•„ì–´',
                    'vi': 'ë² íŠ¸ë‚¨ì–´'
                };
                return languages[code] || code;
            }

            displayTeacherSessions() {
                const sessionList = document.getElementById('sessionList');
                const totalSessions = document.getElementById('totalSessions');
                
                totalSessions.textContent = this.allSessions.length;
                
                if (this.allSessions.length === 0) {
                    sessionList.innerHTML = `
                        <div style="text-align: center; color: #666; font-size: 1.3em; margin: 50px 0;">
                            ì•„ì§ ìƒë‹´ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.
                        </div>
                    `;
                    return;
                }
                
                sessionList.innerHTML = '';
                
                // ìµœì‹  ìˆœìœ¼ë¡œ ì •ë ¬
                const sortedSessions = [...this.allSessions].reverse();
                
                sortedSessions.forEach(session => {
                    const sessionCard = document.createElement('div');
                    sessionCard.className = 'session-card';
                    sessionCard.innerHTML = `
                        <div class="session-header">
                            <div class="student-info">
                                ğŸ‘¦ ${session.name} (${this.getLanguageName(session.language)})
                            </div>
                            <div class="session-time">${session.timestamp}</div>
                        </div>
                        <div class="mood-display">
                            ê¸°ë¶„: ${session.moodEmoji} ${session.mood}
                        </div>
                        ${session.audioUrl ? `
                            <div class="audio-section">
                                <strong>ğŸµ ìŒì„± ë…¹ìŒ:</strong><br>
                                <audio controls style="width: 100%; margin: 10px 0;">
                                    <source src="${session.audioUrl}" type="audio/wav">
                                </audio>
                            </div>
                        ` : ''}
                        ${session.transcription ? `
                            <div>
                                <strong>ğŸ“ ìŒì„± ì¸ì‹ í…ìŠ¤íŠ¸:</strong>
                                <div class="text-content">${session.transcription}</div>
                            </div>
                        ` : ''}
                        ${session.translation ? `
                            <div>
                                <strong>ğŸŒ í•œêµ­ì–´ ë²ˆì—­:</strong>
                                <div class="text-content">${session.translation}</div>
                            </div>
                        ` : ''}
                        <div style="margin-top: 15px;">
                            <button class="btn btn-secondary" onclick="downloadSessionReport(${session.id})" style="font-size: 1em; padding: 8px 16px;">
                                ğŸ“„ ê°œë³„ ë³´ê³ ì„œ ë‹¤ìš´ë¡œë“œ
                            </button>
                            <button class="btn btn-teacher" onclick="deleteSession(${session.id})" style="font-size: 1em; padding: 8px 16px;">
                                ğŸ—‘ï¸ ì‚­ì œ
                            </button>
                        </div>
                    `;
                    sessionList.appendChild(sessionCard);
                });
            }

            generateSessionReport(session) {
                return `
ì½”ì•Œë¼ ìƒë‹´ í”„ë¡œê·¸ë¨ - ê°œë³„ ìƒë‹´ ë³´ê³ ì„œ

=== ê¸°ë³¸ ì •ë³´ ===
í•™ìƒ ì´ë¦„: ${session.name}
ì‚¬ìš© ì–¸ì–´: ${this.getLanguageName(session.language)}
ìƒë‹´ ì¼ì‹œ: ${session.timestamp}
ê¸°ë¶„ ìƒíƒœ: ${session.moodEmoji} ${session.mood}

=== ìŒì„± ì¸ì‹ ê²°ê³¼ ===
${session.transcription || 'ìŒì„± ì¸ì‹ ê²°ê³¼ ì—†ìŒ'}

=== í•œêµ­ì–´ ë²ˆì—­ ===
${session.translation || '(ë²ˆì—­ ë¶ˆí•„ìš” - í•œêµ­ì–´ ì›ë¬¸)'}

=== êµì‚¬ ê´€ì°° ë° ì†Œê²¬ ===
[êµì‚¬ê°€ ì§ì ‘ ì‘ì„±í•˜ëŠ” ì˜ì—­]

ìƒë‹´ í”„ë¡œê·¸ë¨: ì½”ì•Œë¼ (ğŸ¨)
ë³´ê³ ì„œ ìƒì„±ì¼: ${new Date().toLocaleString('ko-KR')}
                `;
            }

            generateAllReport() {
                let report = `
ì½”ì•Œë¼ ìƒë‹´ í”„ë¡œê·¸ë¨ - ì „ì²´ ìƒë‹´ ë³´ê³ ì„œ

ìƒì„±ì¼: ${new Date().toLocaleString('ko-KR')}
ì´ ìƒë‹´ ì„¸ì…˜ ìˆ˜: ${this.allSessions.length}ê°œ

=== ìƒë‹´ ì„¸ì…˜ ëª©ë¡ ===
`;

                this.allSessions.forEach((session, index) => {
                    report += `

${index + 1}. ${session.name} (${this.getLanguageName(session.language)})
   - ìƒë‹´ ì¼ì‹œ: ${session.timestamp}
   - ê¸°ë¶„ ìƒíƒœ: ${session.moodEmoji} ${session.mood}
   - ìŒì„± ì¸ì‹: ${session.transcription || 'ì—†ìŒ'}
   - í•œêµ­ì–´ ë²ˆì—­: ${session.translation || '(í•œêµ­ì–´ ì›ë¬¸)'}
`;
                });

                report += `

=== ì¢…í•© ë¶„ì„ ===
[êµì‚¬ê°€ ì§ì ‘ ì‘ì„±í•˜ëŠ” ì˜ì—­]

ì½”ì•Œë¼ ìƒë‹´ í”„ë¡œê·¸ë¨ (ğŸ¨)
`;
                return report;
            }
        }

        // ì „ì—­ í•¨ìˆ˜ë“¤
        let koalaProgram;

        window.onload = function() {
            koalaProgram = new KoalaProgram();
        };

        function selectLanguage(lang) {
            koalaProgram.sessionData.language = lang;
            koalaProgram.updateKoalaSpeech();
            koalaProgram.showScreen('nameScreen');
        }

        function selectName(name) {
            koalaProgram.sessionData.name = name;
            koalaProgram.showScreen('moodScreen');
        }

        function selectMood(mood, emoji) {
            koalaProgram.sessionData.mood = mood;
            koalaProgram.sessionData.moodEmoji = emoji;
            koalaProgram.showScreen('recordScreen');
        }

        function finishRecording() {
            koalaProgram.processSession();
        }

        function startNew() {
            koalaProgram = new KoalaProgram();
            koalaProgram.showScreen('languageScreen');
        }

        function toggleTeacherView() {
            const studentContainer = document.getElementById('studentContainer');
            const teacherContainer = document.getElementById('teacherContainer');
            
            if (koalaProgram.isTeacherView) {
                studentContainer.style.display = 'block';
                teacherContainer.style.display = 'none';
                koalaProgram.isTeacherView = false;
            } else {
                studentContainer.style.display = 'none';
                teacherContainer.style.display = 'block';
                koalaProgram.isTeacherView = true;
                koalaProgram.displayTeacherSessions();
            }
        }

        function downloadSessionReport(sessionId) {
            const session = koalaProgram.allSessions.find(s => s.id === sessionId);
            if (!session) return;
            
            const report = koalaProgram.generateSessionReport(session);
            const blob = new Blob([report], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ì½”ì•Œë¼ìƒë‹´_${session.name}_${new Date(session.timestamp).toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function downloadAllReports() {
            const report = koalaProgram.generateAllReport();
            const blob = new Blob([report], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ì½”ì•Œë¼ìƒë‹´_ì „ì²´ë³´ê³ ì„œ_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function deleteSession(sessionId) {
            if (confirm('ì´ ìƒë‹´ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                koalaProgram.allSessions = koalaProgram.allSessions.filter(s => s.id !== sessionId);
                localStorage.setItem('koalaSessions', JSON.stringify(koalaProgram.allSessions));
                koalaProgram.displayTeacherSessions();
            }
        }

        function clearAllSessions() {
            if (confirm('ëª¨ë“  ìƒë‹´ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                koalaProgram.allSessions = [];
                localStorage.removeItem('koalaSessions');
                koalaProgram.displayTeacherSessions();
            }
        }
    </script>
</body>
</html>();
                    this.startTimer();
                    
                } catch (error) {
                    console.error('ë§ˆì´í¬ ì ‘ê·¼ ì˜¤ë¥˜:', error);
                    this.recordStatus.textContent = 'ë§ˆì´í¬ ì ‘ê·¼ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.';
                }
            }

            stopRecording() {
                if (this.mediaRecorder && this.isRecording) {
                    this.mediaRecorder.stop();
                    this.isRecording = false;
                    this.stopTimer();
                    this.updateRecordingUI
