<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‹¤ë¬¸í™” í•™ìƒ ìƒë‹´ ì§€ì› í”„ë¡œê·¸ë¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            text-align: center;
            max-width: 600px;
            width: 100%;
            min-height: 500px;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        .title {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .subtitle {
            color: #666;
            font-size: 1.3em;
            margin-bottom: 40px;
            line-height: 1.5;
        }

        /* ì–¸ì–´ ì„ íƒ í™”ë©´ */
        .language-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 30px;
            margin: 40px 0;
        }

        .language-card {
            background: white;
            border-radius: 20px;
            padding: 30px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .language-card:hover {
            transform: translateY(-10px);
            border-color: #ff6b6b;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
        }

        .flag {
            width: 80px;
            height: 60px;
            margin: 0 auto 15px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
        }

        .flag.russia { background: linear-gradient(to bottom, #fff 33%, #0039a6 33%, #0039a6 66%, #d52b1e 66%); }
        .flag.vietnam { background: #da020e; position: relative; }
        .flag.vietnam::after { content: 'â­'; color: #ffff00; font-size: 2em; }
        .flag.korea { background: white; border: 2px solid #ddd; }

        .language-name {
            font-size: 1.4em;
            font-weight: bold;
            color: #333;
        }

        /* ì´ë¦„ ì„ íƒ í™”ë©´ */
        .name-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 40px 0;
        }

        .name-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            padding: 30px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
        }

        .name-card:hover {
            transform: scale(1.05);
            border-color: #fff;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }

        .name-card .avatar {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .name-card .name {
            font-size: 1.3em;
            font-weight: bold;
        }

        /* ê¸°ë¶„ ì„ íƒ í™”ë©´ */
        .mood-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 40px 0;
        }

        .mood-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .mood-card:hover {
            transform: scale(1.1);
            border-color: #ff6b6b;
        }

        .mood-emoji {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .mood-text {
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
        }

        /* ë…¹ìŒ í™”ë©´ */
        .record-section {
            margin: 40px 0;
        }

        .record-button {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
            font-size: 3em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 auto 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 15px 35px rgba(255, 107, 107, 0.3);
        }

        .record-button:hover {
            transform: scale(1.1);
        }

        .record-button.recording {
            background: linear-gradient(45deg, #ff4757, #ff3742);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.15); }
            100% { transform: scale(1); }
        }

        .timer {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
        }

        .status {
            font-size: 1.4em;
            margin: 20px 0;
            color: #333;
            font-weight: 500;
        }

        /* ê²°ê³¼ í™”ë©´ */
        .result-section {
            text-align: left;
            margin: 30px 0;
        }

        .result-box {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            border-left: 5px solid #667eea;
        }

        .result-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .result-content {
            font-size: 1.1em;
            line-height: 1.6;
            color: #555;
        }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            margin: 10px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-success {
            background: linear-gradient(45deg, #51cf66, #40c057);
            color: white;
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 2px solid #ddd;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        /* êµì‚¬ ì •ë³´ íŒ¨ë„ */
        .teacher-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            font-size: 0.9em;
            max-width: 200px;
        }

        .session-info {
            margin-top: 30px;
            padding: 20px;
            background: #e3f2fd;
            border-radius: 15px;
            text-align: left;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 1. ì–¸ì–´ ì„ íƒ í™”ë©´ -->
        <div class="screen active" id="languageScreen">
            <h1 class="title">ğŸŒ ì–¸ì–´ë¥¼ ì„ íƒí•˜ì„¸ìš”</h1>
            <p class="subtitle">Choose your language<br>Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ÑĞ·Ñ‹Ğº<br>Chá»n ngÃ´n ngá»¯ cá»§a báº¡n</p>
            <div class="language-grid">
                <div class="language-card" onclick="selectLanguage('ko')">
                    <div class="flag korea">ğŸ‡°ğŸ‡·</div>
                    <div class="language-name">í•œêµ­ì–´</div>
                </div>
                <div class="language-card" onclick="selectLanguage('ru')">
                    <div class="flag russia">ğŸ‡·ğŸ‡º</div>
                    <div class="language-name">Ğ ÑƒÑÑĞºĞ¸Ğ¹</div>
                </div>
                <div class="language-card" onclick="selectLanguage('vi')">
                    <div class="flag vietnam">ğŸ‡»ğŸ‡³</div>
                    <div class="language-name">Tiáº¿ng Viá»‡t</div>
                </div>
            </div>
        </div>

        <!-- 2. ì´ë¦„ ì„ íƒ í™”ë©´ -->
        <div class="screen" id="nameScreen">
            <h1 class="title">ğŸ‘‹ ì´ë¦„ì„ ì„ íƒí•˜ì„¸ìš”</h1>
            <p class="subtitle" id="nameSubtitle">ëˆ„êµ¬ì„¸ìš”? / ĞšÑ‚Ğ¾ Ñ‚Ñ‹? / Báº¡n lÃ  ai?</p>
            <div class="name-grid">
                <div class="name-card" onclick="selectName('ë¦¬ë§ˆí¬')">
                    <div class="avatar">ğŸ‘¦</div>
                    <div class="name">ë¦¬ë§ˆí¬</div>
                </div>
                <div class="name-card" onclick="selectName('ëˆ„ì—”í‹°ì„±ìš°')">
                    <div class="avatar">ğŸ‘¨</div>
                    <div class="name">ëˆ„ì—”í‹°ì„±ìš°</div>
                </div>
                <div class="name-card" onclick="selectName('ì •ì‹œìœ¨')">
                    <div class="avatar">ğŸ§’</div>
                    <div class="name">ì •ì‹œìœ¨</div>
                </div>
                <div class="name-card" onclick="selectName('ì¡°ìš©ì›')">
                    <div class="avatar">ğŸ‘¶</div>
                    <div class="name">ì¡°ìš©ì›</div>
                </div>
            </div>
        </div>

        <!-- 3. ê¸°ë¶„ ì„ íƒ í™”ë©´ -->
        <div class="screen" id="moodScreen">
            <h1 class="title">ğŸ˜Š ê¸°ë¶„ì´ ì–´ë•Œìš”?</h1>
            <p class="subtitle" id="moodSubtitle">ì˜¤ëŠ˜ ê¸°ë¶„ì€ ì–´ë–¤ê°€ìš”? / ĞšĞ°Ğº Ğ´ĞµĞ»Ğ°? / HÃ´m nay báº¡n cáº£m tháº¥y tháº¿ nÃ o?</p>
            <div class="mood-grid">
                <div class="mood-card" onclick="selectMood('ë§¤ìš° ì¢‹ìŒ', 'ğŸ˜„')">
                    <div class="mood-emoji">ğŸ˜„</div>
                    <div class="mood-text">ë§¤ìš° ì¢‹ìŒ</div>
                </div>
                <div class="mood-card" onclick="selectMood('ì¢‹ìŒ', 'ğŸ˜Š')">
                    <div class="mood-emoji">ğŸ˜Š</div>
                    <div class="mood-text">ì¢‹ìŒ</div>
                </div>
                <div class="mood-card" onclick="selectMood('ë³´í†µ', 'ğŸ˜')">
                    <div class="mood-emoji">ğŸ˜</div>
                    <div class="mood-text">ë³´í†µ</div>
                </div>
                <div class="mood-card" onclick="selectMood('ìŠ¬í””', 'ğŸ˜¢')">
                    <div class="mood-emoji">ğŸ˜¢</div>
                    <div class="mood-text">ìŠ¬í””</div>
                </div>
                <div class="mood-card" onclick="selectMood('í™”ë‚¨', 'ğŸ˜ ')">
                    <div class="mood-emoji">ğŸ˜ </div>
                    <div class="mood-text">í™”ë‚¨</div>
                </div>
                <div class="mood-card" onclick="selectMood('í”¼ê³¤í•¨', 'ğŸ˜´')">
                    <div class="mood-emoji">ğŸ˜´</div>
                    <div class="mood-text">í”¼ê³¤í•¨</div>
                </div>
            </div>
        </div>

        <!-- 4. ë…¹ìŒ í™”ë©´ -->
        <div class="screen" id="recordScreen">
            <h1 class="title">ğŸ¤ ì´ì•¼ê¸°ë¥¼ ë“¤ë ¤ì£¼ì„¸ìš”</h1>
            <p class="subtitle" id="recordSubtitle">ë§ˆì´í¬ë¥¼ ëˆŒëŸ¬ì„œ ì´ì•¼ê¸°í•˜ì„¸ìš”</p>
            
            <div class="record-section">
                <div class="status" id="recordStatus">ë§ˆì´í¬ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”</div>
                <div class="timer" id="recordTimer">00:00</div>
                <button class="record-button" id="recordButton">
                    ğŸ¤
                </button>
                <div>
                    <button class="btn btn-success" id="finishButton" onclick="finishRecording()" disabled>
                        âœ… ì´ì•¼ê¸° ëë‚´ê¸°
                    </button>
                </div>
            </div>
        </div>

        <!-- 5. ê²°ê³¼ í™”ë©´ (êµì‚¬ìš©) -->
        <div class="screen" id="resultScreen">
            <h1 class="title">ğŸ“ ìƒë‹´ ê²°ê³¼</h1>
            <div class="session-info">
                <div><strong>í•™ìƒ:</strong> <span id="resultName"></span></div>
                <div><strong>ì–¸ì–´:</strong> <span id="resultLanguage"></span></div>
                <div><strong>ê¸°ë¶„:</strong> <span id="resultMood"></span></div>
                <div><strong>ì‹œê°„:</strong> <span id="resultTime"></span></div>
            </div>
            
            <div class="result-section">
                <div class="result-box">
                    <div class="result-title">ğŸµ ìŒì„± ë…¹ìŒ</div>
                    <audio id="resultAudio" controls style="width: 100%;"></audio>
                </div>
                
                <div class="result-box">
                    <div class="result-title">ğŸ“ ìŒì„± ì¸ì‹ í…ìŠ¤íŠ¸ <span id="transcribingIndicator"></span></div>
                    <div class="result-content" id="transcribedText">ìŒì„±ì„ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜ ì¤‘...</div>
                </div>
                
                <div class="result-box">
                    <div class="result-title">ğŸŒ í•œêµ­ì–´ ë²ˆì—­ <span id="translatingIndicator"></span></div>
                    <div class="result-content" id="translatedText">ë²ˆì—­ ì¤‘...</div>
                </div>
            </div>
            
            <div>
                <button class="btn btn-primary" onclick="downloadReport()">ğŸ“„ ìƒë‹´ ê²°ê³¼ ë‹¤ìš´ë¡œë“œ</button>
                <button class="btn btn-secondary" onclick="startNew()">ğŸ”„ ìƒˆë¡œìš´ ìƒë‹´ ì‹œì‘</button>
            </div>
        </div>
    </div>

    <!-- êµì‚¬ ì •ë³´ íŒ¨ë„ -->
    <div class="teacher-panel">
        <div><strong>êµì‚¬ìš© ëª¨ë‹ˆí„°ë§</strong></div>
        <div>í˜„ì¬ ë‹¨ê³„: <span id="currentStep">ì–¸ì–´ ì„ íƒ</span></div>
        <div>ì´ ìƒë‹´ ìˆ˜: <span id="sessionCount">0</span></div>
    </div>

    <script>
        class CounselingProgram {
            constructor() {
                this.currentScreen = 'languageScreen';
                this.sessionData = {
                    language: '',
                    name: '',
                    mood: '',
                    moodEmoji: '',
                    timestamp: '',
                    audioBlob: null,
                    transcription: '',
                    translation: ''
                };
                
                this.mediaRecorder = null;
                this.audioChunks = [];
                this.isRecording = false;
                this.recordingTime = 0;
                this.timerInterval = null;
                this.sessionCount = parseInt(localStorage.getItem('sessionCount') || '0');
                
                this.initializeElements();
                this.updateSessionCount();
            }

            initializeElements() {
                this.recordButton = document.getElementById('recordButton');
                this.finishButton = document.getElementById('finishButton');
                this.recordStatus = document.getElementById('recordStatus');
                this.recordTimer = document.getElementById('recordTimer');
                this.resultAudio = document.getElementById('resultAudio');
                
                this.recordButton.addEventListener('click', () => this.toggleRecording());
            }

            showScreen(screenId) {
                document.querySelectorAll('.screen').forEach(screen => {
                    screen.classList.remove('active');
                });
                document.getElementById(screenId).classList.add('active');
                this.currentScreen = screenId;
                this.updateCurrentStep();
            }

            updateCurrentStep() {
                const steps = {
                    'languageScreen': 'ì–¸ì–´ ì„ íƒ',
                    'nameScreen': 'ì´ë¦„ ì„ íƒ',
                    'moodScreen': 'ê¸°ë¶„ ì„ íƒ',
                    'recordScreen': 'ì´ì•¼ê¸° ë…¹ìŒ',
                    'resultScreen': 'ê²°ê³¼ í™•ì¸'
                };
                document.getElementById('currentStep').textContent = steps[this.currentScreen];
            }

            updateSessionCount() {
                document.getElementById('sessionCount').textContent = this.sessionCount;
            }

            async toggleRecording() {
                if (!this.isRecording) {
                    await this.startRecording();
                } else {
                    this.stopRecording();
                }
            }

            async startRecording() {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    
                    this.mediaRecorder = new MediaRecorder(stream);
                    this.audioChunks = [];
                    
                    this.mediaRecorder.ondataavailable = (event) => {
                        this.audioChunks.push(event.data);
                    };
                    
                    this.mediaRecorder.onstop = () => {
                        const audioBlob = new Blob(this.audioChunks, { type: 'audio/wav' });
                        this.sessionData.audioBlob = audioBlob;
                        this.finishButton.disabled = false;
                        stream.getTracks().forEach(track => track.stop());
                    };
                    
                    this.mediaRecorder.start();
                    this.isRecording = true;
                    this.recordingTime = 0;
                    
                    this.updateRecordingUI();
                    this.startTimer();
                    
                } catch (error) {
                    console.error('ë§ˆì´í¬ ì ‘ê·¼ ì˜¤ë¥˜:', error);
                    this.recordStatus.textContent = 'ë§ˆì´í¬ ì ‘ê·¼ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.';
                }
            }

            stopRecording() {
                if (this.mediaRecorder && this.isRecording) {
                    this.mediaRecorder.stop();
                    this.isRecording = false;
                    this.stopTimer();
                    this.updateRecordingUI();
                }
            }

            startTimer() {
                this.timerInterval = setInterval(() => {
                    this.recordingTime++;
                    this.recordTimer.textContent = this.formatTime(this.recordingTime);
                }, 1000);
            }

            stopTimer() {
                if (this.timerInterval) {
                    clearInterval(this.timerInterval);
                    this.timerInterval = null;
                }
            }

            formatTime(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
            }

            updateRecordingUI() {
                if (this.isRecording) {
                    this.recordButton.classList.add('recording');
                    this.recordButton.textContent = 'â¹ï¸';
                    this.recordStatus.textContent = 'ë…¹ìŒ ì¤‘... ë‹¤ì‹œ í´ë¦­í•˜ë©´ ì¤‘ì§€ë©ë‹ˆë‹¤';
                } else {
                    this.recordButton.classList.remove('recording');
                    this.recordButton.textContent = 'ğŸ¤';
                    this.recordStatus.textContent = this.sessionData.audioBlob ? 
                        'ë…¹ìŒ ì™„ë£Œ! ì´ì•¼ê¸° ëë‚´ê¸° ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”' : 'ë§ˆì´í¬ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”';
                }
            }

            async processResults() {
                this.sessionData.timestamp = new Date().toLocaleString('ko-KR');
                
                // ê²°ê³¼ í™”ë©´ì— ê¸°ë³¸ ì •ë³´ í‘œì‹œ
                document.getElementById('resultName').textContent = this.sessionData.name;
                document.getElementById('resultLanguage').textContent = this.getLanguageName(this.sessionData.language);
                document.getElementById('resultMood').textContent = `${this.sessionData.moodEmoji} ${this.sessionData.mood}`;
                document.getElementById('resultTime').textContent = this.sessionData.timestamp;
                
                // ì˜¤ë””ì˜¤ í”Œë ˆì´ì–´ ì„¤ì •
                if (this.sessionData.audioBlob) {
                    const audioUrl = URL.createObjectURL(this.sessionData.audioBlob);
                    this.resultAudio.src = audioUrl;
                }
                
                // ìŒì„± ì¸ì‹ ë° ë²ˆì—­ ì‹œë®¬ë ˆì´ì…˜ (ì‹¤ì œ êµ¬í˜„ ì‹œ Web Speech API ë˜ëŠ” ì™¸ë¶€ ì„œë¹„ìŠ¤ ì‚¬ìš©)
                await this.simulateTranscription();
                await this.simulateTranslation();
                
                this.sessionCount++;
                localStorage.setItem('sessionCount', this.sessionCount.toString());
                this.updateSessionCount();
            }

            async simulateTranscription() {
                document.getElementById('transcribingIndicator').innerHTML = '<span class="loading"></span>';
                
                // ì‹¤ì œë¡œëŠ” Web Speech API ë˜ëŠ” ì™¸ë¶€ ìŒì„±ì¸ì‹ ì„œë¹„ìŠ¤ ì‚¬ìš©
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                const sampleTexts = {
                    'ko': 'ì˜¤ëŠ˜ í•™êµì—ì„œ ì¹œêµ¬ë“¤ê³¼ ì¬ë¯¸ìˆê²Œ ë†€ì•˜ì–´ìš”. í•˜ì§€ë§Œ ìˆ˜í•™ ì‹œê°„ì´ ì¡°ê¸ˆ ì–´ë ¤ì› ì–´ìš”.',
                    'ru': 'Ğ¡ĞµĞ³Ğ¾Ğ´Ğ½Ñ Ğ² ÑˆĞºĞ¾Ğ»Ğµ Ğ±Ñ‹Ğ»Ğ¾ Ğ²ĞµÑĞµĞ»Ğ¾ Ğ¸Ğ³Ñ€Ğ°Ñ‚ÑŒ Ñ Ğ´Ñ€ÑƒĞ·ÑŒÑĞ¼Ğ¸. ĞĞ¾ ÑƒÑ€Ğ¾Ğº Ğ¼Ğ°Ñ‚ĞµĞ¼Ğ°Ñ‚Ğ¸ĞºĞ¸ Ğ±Ñ‹Ğ» Ğ½ĞµĞ¼Ğ½Ğ¾Ğ³Ğ¾ Ñ‚Ñ€ÑƒĞ´Ğ½Ñ‹Ğ¼.',
                    'vi': 'HÃ´m nay á»Ÿ trÆ°á»ng chÆ¡i vá»›i báº¡n bÃ¨ ráº¥t vui. NhÆ°ng tiáº¿t toÃ¡n hÆ¡i khÃ³.'
                };
                
                this.sessionData.transcription = sampleTexts[this.sessionData.language] || sampleTexts['ko'];
                document.getElementById('transcribedText').textContent = this.sessionData.transcription;
                document.getElementById('transcribingIndicator').innerHTML = '';
            }

            async simulateTranslation() {
                if (this.sessionData.language === 'ko') {
                    document.getElementById('translatedText').textContent = '(í•œêµ­ì–´ ì›ë¬¸)';
                    return;
                }
                
                document.getElementById('translatingIndicator').innerHTML = '<span class="loading"></span>';
                
                // ì‹¤ì œë¡œëŠ” Google Translate API ë˜ëŠ” ë‹¤ë¥¸ ë²ˆì—­ ì„œë¹„ìŠ¤ ì‚¬ìš©
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                this.sessionData.translation = 'ì˜¤ëŠ˜ í•™êµì—ì„œ ì¹œêµ¬ë“¤ê³¼ ì¬ë¯¸ìˆê²Œ ë†€ì•˜ì–´ìš”. í•˜ì§€ë§Œ ìˆ˜í•™ ì‹œê°„ì´ ì¡°ê¸ˆ ì–´ë ¤ì› ì–´ìš”.';
                document.getElementById('translatedText').textContent = this.sessionData.translation;
                document.getElementById('translatingIndicator').innerHTML = '';
            }

            getLanguageName(code) {
                const languages = {
                    'ko': 'í•œêµ­ì–´',
                    'ru': 'ëŸ¬ì‹œì•„ì–´',
                    'vi': 'ë² íŠ¸ë‚¨ì–´'
                };
                return languages[code] || code;
            }

            generateReport() {
                const report = `
ë‹¤ë¬¸í™” í•™ìƒ ìƒë‹´ ê²°ê³¼ ë³´ê³ ì„œ

=== ê¸°ë³¸ ì •ë³´ ===
í•™ìƒ ì´ë¦„: ${this.sessionData.name}
ì‚¬ìš© ì–¸ì–´: ${this.getLanguageName(this.sessionData.language)}
ìƒë‹´ ì¼ì‹œ: ${this.sessionData.timestamp}
ê¸°ë¶„ ìƒíƒœ: ${this.sessionData.moodEmoji} ${this.sessionData.mood}

=== ìŒì„± ì¸ì‹ ê²°ê³¼ ===
${this.sessionData.transcription}

=== í•œêµ­ì–´ ë²ˆì—­ ===
${this.sessionData.translation || '(ë²ˆì—­ ë¶ˆí•„ìš” - í•œêµ­ì–´ ì›ë¬¸)'}

=== êµì‚¬ ì†Œê²¬ë€ ===
[êµì‚¬ê°€ ì§ì ‘ ì‘ì„±]

ìƒë‹´ í”„ë¡œê·¸ë¨ ìƒì„±ì¼: ${new Date().toLocaleString('ko-KR')}
                `;
                return report;
            }
        }

        // ì „ì—­ í•¨ìˆ˜ë“¤
        let counselingProgram;

        window.onload = function() {
            counselingProgram = new CounselingProgram();
        };

        function selectLanguage(lang) {
            counselingProgram.sessionData.language = lang;
            counselingProgram.showScreen('nameScreen');
        }

        function selectName(name) {
            counselingProgram.sessionData.name = name;
            counselingProgram.showScreen('moodScreen');
        }

        function selectMood(mood, emoji) {
            counselingProgram.sessionData.mood = mood;
            counselingProgram.sessionData.moodEmoji = emoji;
            counselingProgram.showScreen('recordScreen');
        }

        function finishRecording() {
            counselingProgram.showScreen('resultScreen');
            counselingProgram.processResults();
        }

        function downloadReport() {
            const report = counselingProgram.generateReport();
            const blob = new Blob([report], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ìƒë‹´ê²°ê³¼_${counselingProgram.sessionData.name}_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function startNew() {
            counselingProgram = new CounselingProgram();
            counselingProgram.showScreen('languageScreen');
        }
    </script>
</body>
</html>
