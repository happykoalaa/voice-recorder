<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Îã§Î¨∏Ìôî ÌïôÏÉù ÏÉÅÎã¥ ÏßÄÏõê ÌîÑÎ°úÍ∑∏Îû®</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            text-align: center;
            max-width: 600px;
            width: 100%;
            min-height: 500px;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        .title {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .subtitle {
            color: #666;
            font-size: 1.3em;
            margin-bottom: 40px;
            line-height: 1.5;
        }

        /* Ïñ∏Ïñ¥ ÏÑ†ÌÉù ÌôîÎ©¥ */
        .language-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 30px;
            margin: 40px 0;
        }

        .language-card {
            background: white;
            border-radius: 20px;
            padding: 30px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .language-card:hover {
            transform: translateY(-10px);
            border-color: #ff6b6b;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
        }

        .flag {
            width: 80px;
            height: 60px;
            margin: 0 auto 15px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
        }

        .flag.russia { background: linear-gradient(to bottom, #fff 33%, #0039a6 33%, #0039a6 66%, #d52b1e 66%); }
        .flag.vietnam { background: #da020e; position: relative; }
        .flag.vietnam::after { content: '‚≠ê'; color: #ffff00; font-size: 2em; }
        .flag.korea { background: white; border: 2px solid #ddd; }

        .language-name {
            font-size: 1.4em;
            font-weight: bold;
            color: #333;
        }

        /* Ïù¥Î¶Ñ ÏÑ†ÌÉù ÌôîÎ©¥ */
        .name-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 40px 0;
        }

        .name-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            padding: 30px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
        }

        .name-card:hover {
            transform: scale(1.05);
            border-color: #fff;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }

        .name-card .avatar {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .name-card .name {
            font-size: 1.3em;
            font-weight: bold;
        }

        /* Í∏∞Î∂Ñ ÏÑ†ÌÉù ÌôîÎ©¥ */
        .mood-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 40px 0;
        }

        .mood-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .mood-card:hover {
            transform: scale(1.1);
            border-color: #ff6b6b;
        }

        .mood-emoji {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .mood-text {
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
        }

        /* ÎÖπÏùå ÌôîÎ©¥ */
        .record-section {
            margin: 40px 0;
        }

        .record-button {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
            font-size: 3em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 auto 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 15px 35px rgba(255, 107, 107, 0.3);
        }

        .record-button:hover {
            transform: scale(1.1);
        }

        .record-button.recording {
            background: linear-gradient(45deg, #ff4757, #ff3742);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.15); }
            100% { transform: scale(1); }
        }

        .timer {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
        }

        .status {
            font-size: 1.4em;
            margin: 20px 0;
            color: #333;
            font-weight: 500;
        }

        /* Í≤∞Í≥º ÌôîÎ©¥ */
        .result-section {
            text-align: left;
            margin: 30px 0;
        }

        .result-box {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            border-left: 5px solid #667eea;
        }

        .result-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .result-content {
            font-size: 1.1em;
            line-height: 1.6;
            color: #555;
        }

        /* Î≤ÑÌäº Ïä§ÌÉÄÏùº */
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            margin: 10px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-success {
            background: linear-gradient(45deg, #51cf66, #40c057);
            color: white;
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 2px solid #ddd;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        /* ÍµêÏÇ¨ Ï†ïÎ≥¥ Ìå®ÎÑê */
        .teacher-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            font-size: 0.9em;
            max-width: 200px;
        }

        .session-info {
            margin-top: 30px;
            padding: 20px;
            background: #e3f2fd;
            border-radius: 15px;
            text-align: left;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 1. Ïñ∏Ïñ¥ ÏÑ†ÌÉù ÌôîÎ©¥ -->
        <div class="screen active" id="languageScreen">
            <h1 class="title">üåç Ïñ∏Ïñ¥Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</h1>
            <p class="subtitle">Choose your language<br>–í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫<br>Ch·ªçn ng√¥n ng·ªØ c·ªßa b·∫°n</p>
            <div class="language-grid">
                <div class="language-card" onclick="selectLanguage('ko')">
                    <div class="flag korea">üá∞üá∑</div>
                    <div class="language-name">ÌïúÍµ≠Ïñ¥</div>
                </div>
                <div class="language-card" onclick="selectLanguage('ru')">
                    <div class="flag russia">üá∑üá∫</div>
                    <div class="language-name">–†—É—Å—Å–∫–∏–π</div>
                </div>
                <div class="language-card" onclick="selectLanguage('vi')">
                    <div class="flag vietnam">üáªüá≥</div>
                    <div class="language-name">Ti·∫øng Vi·ªát</div>
                </div>
            </div>
        </div>

        <!-- 2. Ïù¥Î¶Ñ ÏÑ†ÌÉù ÌôîÎ©¥ -->
        <div class="screen" id="nameScreen">
            <h1 class="title">üëã Ïù¥Î¶ÑÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</h1>
            <p class="subtitle" id="nameSubtitle">ÎàÑÍµ¨ÏÑ∏Ïöî? / –ö—Ç–æ —Ç—ã? / B·∫°n l√† ai?</p>
            <div class="name-grid">
                <div class="name-card" onclick="selectName('Î¶¨ÎßàÌÅ¨')">
                    <div class="avatar">üë¶</div>
                    <div class="name">Î¶¨ÎßàÌÅ¨</div>
                </div>
                <div class="name-card" onclick="selectName('ÎàÑÏóîÌã∞ÏÑ±Ïö∞')">
                    <div class="avatar">üë®</div>
                    <div class="name">ÎàÑÏóîÌã∞ÏÑ±Ïö∞</div>
                </div>
                <div class="name-card" onclick="selectName('Ï†ïÏãúÏú®')">
                    <div class="avatar">üßí</div>
                    <div class="name">Ï†ïÏãúÏú®</div>
                </div>
                <div class="name-card" onclick="selectName('Ï°∞Ïö©Ïõê')">
                    <div class="avatar">üë∂</div>
                    <div class="name">Ï°∞Ïö©Ïõê</div>
                </div>
            </div>
        </div>

        <!-- 3. Í∏∞Î∂Ñ ÏÑ†ÌÉù ÌôîÎ©¥ -->
        <div class="screen" id="moodScreen">
            <h1 class="title">üòä Í∏∞Î∂ÑÏù¥ Ïñ¥ÎïåÏöî?</h1>
            <p class="subtitle" id="moodSubtitle">Ïò§Îäò Í∏∞Î∂ÑÏùÄ Ïñ¥Îñ§Í∞ÄÏöî? / –ö–∞–∫ –¥–µ–ª–∞? / H√¥m nay b·∫°n c·∫£m th·∫•y th·∫ø n√†o?</p>
            <div class="mood-grid">
                <div class="mood-card" onclick="selectMood('Îß§Ïö∞ Ï¢ãÏùå', 'üòÑ')">
                    <div class="mood-emoji">üòÑ</div>
                    <div class="mood-text">Îß§Ïö∞ Ï¢ãÏùå</div>
                </div>
                <div class="mood-card" onclick="selectMood('Ï¢ãÏùå', 'üòä')">
                    <div class="mood-emoji">üòä</div>
                    <div class="mood-text">Ï¢ãÏùå</div>
                </div>
                <div class="mood-card" onclick="selectMood('Î≥¥ÌÜµ', 'üòê')">
                    <div class="mood-emoji">üòê</div>
                    <div class="mood-text">Î≥¥ÌÜµ</div>
                </div>
                <div class="mood-card" onclick="selectMood('Ïä¨Ìîî', 'üò¢')">
                    <div class="mood-emoji">üò¢</div>
                    <div class="mood-text">Ïä¨Ìîî</div>
                </div>
                <div class="mood-card" onclick="selectMood('ÌôîÎÇ®', 'üò†')">
                    <div class="mood-emoji">üò†</div>
                    <div class="mood-text">ÌôîÎÇ®</div>
                </div>
                <div class="mood-card" onclick="selectMood('ÌîºÍ≥§Ìï®', 'üò¥')">
                    <div class="mood-emoji">üò¥</div>
                    <div class="mood-text">ÌîºÍ≥§Ìï®</div>
                </div>
            </div>
        </div>

        <!-- 4. ÎÖπÏùå ÌôîÎ©¥ -->
        <div class="screen" id="recordScreen">
            <h1 class="title">üé§ Ïù¥ÏïºÍ∏∞Î•º Îì§Î†§Ï£ºÏÑ∏Ïöî</h1>
            <p class="subtitle" id="recordSubtitle">ÎßàÏù¥ÌÅ¨Î•º ÎàåÎü¨ÏÑú Ïù¥ÏïºÍ∏∞ÌïòÏÑ∏Ïöî</p>
            
            <div class="record-section">
                <div class="status" id="recordStatus">ÎßàÏù¥ÌÅ¨ Î≤ÑÌäºÏùÑ ÎàÑÎ•¥ÏÑ∏Ïöî</div>
                <div class="timer" id="recordTimer">00:00</div>
                <button class="record-button" id="recordButton">
                    üé§
                </button>
                <div>
                    <button class="btn btn-success" id="finishButton" onclick="finishRecording()" disabled>
                        ‚úÖ Ïù¥ÏïºÍ∏∞ ÎÅùÎÇ¥Í∏∞
                    </button>
                </div>
            </div>
        </div>

        <!-- 5. Í≤∞Í≥º ÌôîÎ©¥ (ÍµêÏÇ¨Ïö©) -->
        <div class="screen" id="resultScreen">
            <h1 class="title">üìù ÏÉÅÎã¥ Í≤∞Í≥º</h1>
            <div class="session-info">
                <div><strong>ÌïôÏÉù:</strong> <span id="resultName"></span></div>
                <div><strong>Ïñ∏Ïñ¥:</strong> <span id="resultLanguage"></span></div>
                <div><strong>Í∏∞Î∂Ñ:</strong> <span id="resultMood"></span></div>
                <div><strong>ÏãúÍ∞Ñ:</strong> <span id="resultTime"></span></div>
            </div>
            
            <div class="result-section">
                <div class="result-box">
                    <div class="result-title">üéµ ÏùåÏÑ± ÎÖπÏùå</div>
                    <audio id="resultAudio" controls style="width: 100%;"></audio>
                </div>
                
                <div class="result-box">
                    <div class="result-title">üìù ÏùåÏÑ± Ïù∏Ïãù ÌÖçÏä§Ìä∏ <span id="transcribingIndicator"></span></div>
                    <div class="result-content" id="transcribedText">ÏùåÏÑ±ÏùÑ ÌÖçÏä§Ìä∏Î°ú Î≥ÄÌôò Ï§ë...</div>
                </div>
                
                <div class="result-box">
                    <div class="result-title">üåê ÌïúÍµ≠Ïñ¥ Î≤àÏó≠ <span id="translatingIndicator"></span></div>
                    <div class="result-content" id="translatedText">Î≤àÏó≠ Ï§ë...</div>
                </div>
            </div>
            
            <div>
                <button class="btn btn-primary" onclick="downloadReport()">üìÑ ÏÉÅÎã¥ Í≤∞Í≥º Îã§Ïö¥Î°úÎìú</button>
                <button class="btn btn-secondary" onclick="startNew()">üîÑ ÏÉàÎ°úÏö¥ ÏÉÅÎã¥ ÏãúÏûë</button>
            </div>
        </div>
    </div>

    <!-- ÍµêÏÇ¨ Ï†ïÎ≥¥ Ìå®ÎÑê -->
    <div class="teacher-panel">
        <div><strong>ÍµêÏÇ¨Ïö© Î™®ÎãàÌÑ∞ÎßÅ</strong></div>
        <div>ÌòÑÏû¨ Îã®Í≥Ñ: <span id="currentStep">Ïñ∏Ïñ¥ ÏÑ†ÌÉù</span></div>
        <div>Ï¥ù ÏÉÅÎã¥ Ïàò: <span id="sessionCount">0</span></div>
    </div>

    <script>
        class CounselingProgram {
            constructor() {
                this.currentScreen = 'languageScreen';
                this.sessionData = {
                    language: '',
                    name: '',
                    mood: '',
                    moodEmoji: '',
                    timestamp: '',
                    audioBlob: null,
                    transcription: '',
                    translation: ''
                };
                
                this.mediaRecorder = null;
                this.audioChunks = [];
                this.isRecording = false;
                this.recordingTime = 0;
                this.timerInterval = null;
                this.sessionCount = parseInt(localStorage.getItem('sessionCount') || '0');
                
                this.initializeElements();
                this.updateSessionCount();
            }

            initializeElements() {
                this.recordButton = document.getElementById('recordButton');
                this.finishButton = document.getElementById('finishButton');
                this.recordStatus = document.getElementById('recordStatus');
                this.recordTimer = document.getElementById('recordTimer');
                this.resultAudio = document.getElementById('resultAudio');
                
                this.recordButton.addEventListener('click', () => this.toggleRecording());
            }

            showScreen(screenId) {
                document.querySelectorAll('.screen').forEach(screen => {
                    screen.classList.remove('active');
                });
                document.getElementById(screenId).classList.add('active');
                this.currentScreen = screenId;
                this.updateCurrentStep();
            }

            updateCurrentStep() {
                const steps = {
                    'languageScreen': 'Ïñ∏Ïñ¥ ÏÑ†ÌÉù',
                    'nameScreen': 'Ïù¥Î¶Ñ ÏÑ†ÌÉù',
                    'moodScreen': 'Í∏∞Î∂Ñ ÏÑ†ÌÉù',
                    'recordScreen': 'Ïù¥ÏïºÍ∏∞ ÎÖπÏùå',
                    'resultScreen': 'Í≤∞Í≥º ÌôïÏù∏'
                };
                document.getElementById('currentStep').textContent = steps[this.currentScreen];
            }

            updateSessionCount() {
                document.getElementById('sessionCount').textContent = this.sessionCount;
            }

            async toggleRecording() {
                if (!this.isRecording) {
                    await this.startRecording();
                } else {
                    this.stopRecording();
                }
            }

            async startRecording() {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    
                    this.mediaRecorder = new MediaRecorder(stream);
                    this.audioChunks = [];
                    
                    this.mediaRecorder.ondataavailable = (event) => {
                        this.audioChunks.push(event.data);
                    };
                    
                    this.mediaRecorder.onstop = () => {
                        const audioBlob = new Blob(this.audioChunks, { type: 'audio/wav' });
                        this.sessionData.audioBlob = audioBlob;
                        this.finishButton.disabled = false;
                        stream.getTracks().forEach(track => track.stop());
                    };
                    
                    this.mediaRecorder.start();
                    this.isRecording = true;
                    this.recordingTime = 0;
                    
                    this.updateRecordingUI();
                    this.startTimer();
                    
                } catch (error) {
                    console.error('ÎßàÏù¥ÌÅ¨ Ï†ëÍ∑º Ïò§Î•ò:', error);
                    this.recordStatus.textContent = 'ÎßàÏù¥ÌÅ¨ Ï†ëÍ∑ºÏù¥ Í±∞Î∂ÄÎêòÏóàÏäµÎãàÎã§.';
                }
            }

            stopRecording() {
                if (this.mediaRecorder && this.isRecording) {
                    this.mediaRecorder.stop();
                    this.isRecording = false;
                    this.stopTimer();
                    this.updateRecordingUI();
                }
            }

            startTimer() {
                this.timerInterval = setInterval(() => {
                    this.recordingTime++;
                    this.recordTimer.textContent = this.formatTime(this.recordingTime);
                }, 1000);
            }

            stopTimer() {
                if (this.timerInterval) {
                    clearInterval(this.timerInterval);
                    this.timerInterval = null;
                }
            }

            formatTime(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
            }

            updateRecordingUI() {
                if (this.isRecording) {
                    this.recordButton.classList.add('recording');
                    this.recordButton.textContent = '‚èπÔ∏è';
                    this.recordStatus.textContent = 'ÎÖπÏùå Ï§ë... Îã§Ïãú ÌÅ¥Î¶≠ÌïòÎ©¥ Ï§ëÏßÄÎê©ÎãàÎã§';
                } else {
                    this.recordButton.classList.remove('recording');
                    this.recordButton.textContent = 'üé§';
                    this.recordStatus.textContent = this.sessionData.audioBlob ? 
                        'ÎÖπÏùå ÏôÑÎ£å! Ïù¥ÏïºÍ∏∞ ÎÅùÎÇ¥Í∏∞ Î≤ÑÌäºÏùÑ ÎàÑÎ•¥ÏÑ∏Ïöî' : 'ÎßàÏù¥ÌÅ¨ Î≤ÑÌäºÏùÑ ÎàÑÎ•¥ÏÑ∏Ïöî';
                }
            }

            async processResults() {
                this.sessionData.timestamp = new Date().toLocaleString('ko-KR');
                
                // Í≤∞Í≥º ÌôîÎ©¥Ïóê Í∏∞Î≥∏ Ï†ïÎ≥¥ ÌëúÏãú
                document.getElementById('resultName').textContent = this.sessionData.name;
                document.getElementById('resultLanguage').textContent = this.getLanguageName(this.sessionData.language);
                document.getElementById('resultMood').textContent = `${this.sessionData.moodEmoji} ${this.sessionData.mood}`;
                document.getElementById('resultTime').textContent = this.sessionData.timestamp;
                
                // Ïò§ÎîîÏò§ ÌîåÎ†àÏù¥Ïñ¥ ÏÑ§Ï†ï
                if (this.sessionData.audioBlob) {
                    const audioUrl = URL.createObjectURL(this.sessionData.audioBlob);
                    this.resultAudio.src = audioUrl;
                }
                
                // ÏùåÏÑ± Ïù∏Ïãù Î∞è Î≤àÏó≠ ÏãúÎÆ¨Î†àÏù¥ÏÖò (Ïã§Ï†ú Íµ¨ÌòÑ Ïãú Web Speech API ÎòêÎäî Ïô∏Î∂Ä ÏÑúÎπÑÏä§ ÏÇ¨Ïö©)
                await this.simulateTranscription();
                await this.simulateTranslation();
                
                this.sessionCount++;
                localStorage.setItem('sessionCount', this.sessionCount.toString());
                this.updateSessionCount();
            }

            async simulateTranscription() {
                document.getElementById('transcribingIndicator').innerHTML = '<span class="loading"></span>';
                
                // Ïã§Ï†úÎ°úÎäî Web Speech API ÎòêÎäî Ïô∏Î∂Ä ÏùåÏÑ±Ïù∏Ïãù ÏÑúÎπÑÏä§ ÏÇ¨Ïö©
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                const sampleTexts = {
                    'ko': 'Ïò§Îäò ÌïôÍµêÏóêÏÑú ÏπúÍµ¨Îì§Í≥º Ïû¨ÎØ∏ÏûàÍ≤å ÎÜÄÏïòÏñ¥Ïöî. ÌïòÏßÄÎßå ÏàòÌïô ÏãúÍ∞ÑÏù¥ Ï°∞Í∏à Ïñ¥Î†§Ïõ†Ïñ¥Ïöî.',
                    'ru': '–°–µ–≥–æ–¥–Ω—è –≤ —à–∫–æ–ª–µ –±—ã–ª–æ –≤–µ—Å–µ–ª–æ –∏–≥—Ä–∞—Ç—å —Å –¥—Ä—É–∑—å—è–º–∏. –ù–æ —É—Ä–æ–∫ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏ –±—ã–ª –Ω–µ–º–Ω–æ–≥–æ —Ç—Ä—É–¥–Ω—ã–º.',
                    'vi': 'H√¥m nay ·ªü tr∆∞·ªùng ch∆°i v·ªõi b·∫°n b√® r·∫•t vui. Nh∆∞ng ti·∫øt to√°n h∆°i kh√≥.'
                };
                
                this.sessionData.transcription = sampleTexts[this.sessionData.language] || sampleTexts['ko'];
                document.getElementById('transcribedText').textContent = this.sessionData.transcription;
                document.getElementById('transcribingIndicator').innerHTML = '';
            }

            async simulateTranslation() {
                if (this.sessionData.language === 'ko') {
                    document.getElementById('translatedText').textContent = '(ÌïúÍµ≠Ïñ¥ ÏõêÎ¨∏)';
                    return;
                }
                
                document.getElementById('translatingIndicator').innerHTML = '<span class="loading"></span>';
                
                // Ïã§Ï†úÎ°úÎäî Google Translate API ÎòêÎäî Îã§Î•∏ Î≤àÏó≠ ÏÑúÎπÑÏä§ ÏÇ¨Ïö©
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                this.sessionData.translation = 'Ïò§Îäò ÌïôÍµêÏóêÏÑú ÏπúÍµ¨Îì§Í≥º Ïû¨ÎØ∏ÏûàÍ≤å ÎÜÄÏïòÏñ¥Ïöî. ÌïòÏßÄÎßå ÏàòÌïô ÏãúÍ∞ÑÏù¥ Ï°∞Í∏à Ïñ¥Î†§Ïõ†Ïñ¥Ïöî.';
                document.getElementById('translatedText').textContent = this.sessionData.translation;
                document.getElementById('translatingIndicator').innerHTML = '';
            }

            getLanguageName(code) {
                const languages = {
                    'ko': 'ÌïúÍµ≠Ïñ¥',
                    'ru': 'Îü¨ÏãúÏïÑÏñ¥',
                    'vi': 'Î≤†Ìä∏ÎÇ®Ïñ¥'
                };
                return languages[code] || code;
            }

            generateReport() {
                const report = `
Îã§Î¨∏Ìôî ÌïôÏÉù ÏÉÅÎã¥ Í≤∞Í≥º Î≥¥Í≥†ÏÑú

=== Í∏∞Î≥∏ Ï†ïÎ≥¥ ===
ÌïôÏÉù Ïù¥Î¶Ñ: ${this.sessionData.name}
ÏÇ¨Ïö© Ïñ∏Ïñ¥: ${this.getLanguageName(this.sessionData.language)}
ÏÉÅÎã¥ ÏùºÏãú: ${this.sessionData.timestamp}
Í∏∞Î∂Ñ ÏÉÅÌÉú: ${this.sessionData.moodEmoji} ${this.sessionData.mood}

=== ÏùåÏÑ± Ïù∏Ïãù Í≤∞Í≥º ===
${this.sessionData.transcription}

=== ÌïúÍµ≠Ïñ¥ Î≤àÏó≠ ===
${this.sessionData.translation || '(Î≤àÏó≠ Î∂àÌïÑÏöî - ÌïúÍµ≠Ïñ¥ ÏõêÎ¨∏)'}

=== ÍµêÏÇ¨ ÏÜåÍ≤¨ÎûÄ ===
[ÍµêÏÇ¨Í∞Ä ÏßÅÏ†ë ÏûëÏÑ±]

ÏÉÅÎã¥ ÌîÑÎ°úÍ∑∏Îû® ÏÉùÏÑ±Ïùº: ${new Date().toLocaleString('ko-KR')}
                `;
                return report;
            }
        }

        // Ï†ÑÏó≠ Ìï®ÏàòÎì§
        let counselingProgram;

        window.onload = function() {
            counselingProgram = new CounselingProgram();
        };

        function selectLanguage(lang) {
            counselingProgram.sessionData.language = lang;
            counselingProgram.showScreen('nameScreen');
        }

        function selectName(name) {
            counselingProgram.sessionData.name = name;
            counselingProgram.showScreen('moodScreen');
        }

        function selectMood(mood, emoji) {
            counselingProgram.sessionData.mood = mood;
            counselingProgram.sessionData.moodEmoji = emoji;
            counselingProgram.showScreen('recordScreen');
        }

        function finishRecording() {
            counselingProgram.showScreen('resultScreen');
            counselingProgram.processResults();
        }

        function downloadReport() {
            const report = counselingProgram.generateReport();
            const blob = new Blob([report], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ÏÉÅÎã¥Í≤∞Í≥º_${counselingProgram.sessionData.name}_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function startNew() {
            counselingProgram = new CounselingProgram();
            counselingProgram.showScreen('languageScreen');
        }
    </script>
</body>
</html>
